CREATE DATABASE minh2602
go

USE minh2602
go

CREATE TABLE TaiKhoan(
TenTK nvarchar(50) not null,
MatKhau nvarchar(20) not null,
Gmail nvarchar(500) not null
)
go


CREATE TABLE Bo_Phan (
    MaBoPhan int PRIMARY KEY,
    TenBoPhan nvarchar(255) NOT NULL
)
go

CREATE TABLE nhanvien (
    MaNV nvarchar(10) PRIMARY KEY,
    HoTenNV nvarchar(255) NOT NULL,
    GioiTinh nvarchar(255),
    NgaySinh date,
    DiaChi nvarchar(255),
    ChucVu nvarchar(50),
    CMND nvarchar(20),
    SDT nvarchar(20),
    Email nvarchar(100),
    MaBoPhan int,
	FOREIGN KEY (MaBoPhan) REFERENCES Bo_Phan(MaBoPhan)
)
go

CREATE TABLE LUONG (
    MaNV nvarchar(10),
    Thang int CHECK (Thang >= 1 AND Thang <= 12),
    Nam int CHECK (Nam >= 1900 AND Nam <= 2100),
    LuongCB float,
    HeSoLuong float,
    PhuCap float,
    TongLuong float,
    PRIMARY KEY (MaNV, Thang, Nam),
    FOREIGN KEY (MaNV) REFERENCES nhanvien(MaNV)
)
go

CREATE TABLE ChamCong (
    MaNV nvarchar(10),
    Thang int CHECK (Thang >= 1 AND Thang <= 12),
    Nam int CHECK (Nam >= 1900 AND Nam <= 2100),
    Ngay date,
    GioVao time,
    GioRa time,
    PRIMARY KEY (MaNV, Thang, Nam, Ngay),
    FOREIGN KEY (MaNV) REFERENCES nhanvien(MaNV)
)
go
ALTER TABLE ChamCong
ADD PhatDiMuon float DEFAULT 0,
    PhatNghi float DEFAULT 0,
    TangCa float DEFAULT 0;



INSERT INTO Bo_Phan (MaBoPhan, TenBoPhan)
VALUES 
    (1, N'Bộ phận kế toán'),
    (2, N'Bộ phận kinh doanh'),
    (3, N'Bộ phận nhân sự'),
    (4, N'Bộ phận IT');
INSERT INTO nhanvien (MaNV, HoTenNV, GioiTinh, NgaySinh, DiaChi, ChucVu, CMND, SDT, Email, MaBoPhan)
VALUES 
(01, N'Nguyễn Văn Nam', N'Nam', N'1990-01-01', N'Hà Nội', N'Thu Ky', N'032303008637', N'0987654321', N'nva@gmail.com', 1),
(02, N'Nguyễn Văn Tú', N'Nam', N'1992-02-02', N'Hà Nội', N'Thu Ky', N'032303008638', N'0987654322', N'nvtu@gmail.com', 1),
(03, N'Nguyễn Thị Hương', N'Nữ', N'1995-03-03', N'Thái Bình', N'Quản Lý', N'032303008639', N'0987654323', N'nthuong@gmail.com', 2),
(04, N'Lê Quang Minh', N'Nam', N'1993-04-04', N'Đà Nẵng', N'Nhan Vien', N'032303008640', N'0987654324', N'lqminh@gmail.com', 2),
(05, N'Nguyễn Thị Thanh Huyền', N'Nữ', N'1991-05-05', N'Điện Biên', N'Nhập Liệu', N'032303008641', N'0987654325', N'ntthuyen@gmail.com', 3),
(06, N'Phạm Văn Nam', N'Nam', N'1990-06-06', N'Bắ+c Giang', N' Nhập Liệu', N'032303008642', N'0987654326', N'pvn@gmail.com', 3),
(07, N'Lê Thị Thu Hà', N'Nữ', N'1992-07-07', N'Nam Định', N'Kế Toán', N'032303008643', N'0987654327', N'ltth@gmail.com', 4),
(08, N'Lê Thị Hằng', N'Nữ', N'1991-11-11', N'Hải Dương', N'Quản Lý', N'032303008651', N'0987654331', N'lthang@gmail.com', 2),
(09, N'Phạm Văn Lâm', N'Nam', N'1992-12-12', N'Nam Định', N'Nhan Vien', N'032303008652', N'0987654332', N'pvlam@gmail.com', 4),
(10, N'Trần Thị Mai', N'Nữ', N'1993-01-13', N'Thái Nguyên', N'Thu Nhập Liệu', N'032303008653', N'0987654333', N'ttmai@gmail.com', 3);
INSERT INTO LUONG (MaNV, Thang, Nam, LuongCB, HeSoLuong, PhuCap, TongLuong)
VALUES
(01, 1, 2022, 4500000, 2.5, 1000000, 13500000),
(02, 1, 2022, 3500000, 2.0, 800000, 9800000),
(03, 1, 2022, 5000000, 3.0, 1200000, 20400000),
(04, 1, 2022, 5500000, 2.5, 1000000, 14375000),
(05, 1, 2022, 5000000, 2.0, 800000, 10000000),
(06, 1, 2022, 7000000, 3.5, 1500000, 28750000),
(07, 1, 2022, 6500000, 3.0, 1200000, 22100000),
(08, 1, 2022, 3500000, 2.5, 1000000, 13500000),
(09, 1, 2022, 4500000, 2.0, 800000, 9800000),
(10, 1, 2022, 6000000, 3.0, 1200000, 20400000),
(01, 2, 2022, 4500000, 2.5, 1000000, 13500000),
(01, 3, 2022, 5000000, 2.5, 1000000, 13500000),
(01, 4, 2022, 5000000, 2.5, 1200000, 14500000),
(01, 5, 2022, 5000000, 2.5, 1200000, 14500000),
(01, 6, 2022, 5000000, 2.5, 1200000, 14500000),
(01, 7, 2022, 5000000, 2.5, 1200000, 14500000),
(01, 8, 2022, 5000000, 2.5, 1200000, 14500000),
(01, 9, 2022, 5000000, 2.5, 1200000, 14500000),
(01, 10, 2022, 5000000, 2.5, 1200000, 14500000),
(01, 11, 2022, 5000000, 2.5, 1200000, 14500000),
(01, 12, 2022, 5000000, 2.5, 1200000, 14500000),
(02, 2, 2022, 4500000, 2.0, 800000, 9800000),
(02, 3, 2022, 4500000, 2.0, 800000, 9800000),
(02, 4, 2022, 4500000, 2.0, 800000, 9800000),
(02, 5, 2022, 4500000, 2.0, 800000, 9800000),
(02, 6, 2022, 4500000, 2.0, 800000, 9800000),
(02, 7, 2022, 4500000, 2.0, 800000, 9800000),
(02, 8, 2022, 4500000, 2.0, 800000, 9800000),
(02, 9, 2022, 4500000, 2.0, 800000, 9800000),
(02, 10, 2022, 4500000, 2.0, 800000, 9800000),
(02, 11, 2022, 4500000, 2.0, 800000, 9800000),
(02, 12, 2022, 4500000, 2.0, 800000, 9800000),
(03, 2, 2022, 6000000, 3.0, 1200000, 20400000),
(03, 3, 2022, 6000000, 3.0, 1200000, 20400000),
(03, 4, 2022, 6000000, 3.0, 1200000, 20400000),
(03, 5, 2022, 6000000, 3.0, 1200000, 20400000),
(03, 6, 2022, 6000000, 3.0, 1200000, 20400000),
(03, 7, 2022, 6000000, 3.0, 1200000, 20400000),
(03, 8, 2022, 6000000, 3.0, 1200000, 20400000),
(03, 9, 2022, 6000000, 3.0, 1200000, 20400000),
(03, 10, 2022, 6000000, 3.0, 1200000, 20400000),
(03, 11, 2022, 6000000, 3.0, 1200000, 20400000),
(03, 12, 2022, 6000000, 3.0, 1200000, 20400000),
(04, 2, 2022, 5500000, 2.5, 1000000, 14375000),
(04, 3, 2022, 5500000, 2.5, 1000000, 14375000),
(04, 4, 2022, 5500000, 2.5, 1000000, 14375000),
(04, 5, 2022, 5500000, 2.5, 1000000, 14375000),
(04, 6, 2022, 5500000, 2.5, 1000000, 14375000),
(04, 7, 2022, 5500000, 2.5, 1000000, 14375000),
(04, 8, 2022, 5500000, 2.5, 1000000, 14375000),
(04, 9, 2022, 5500000, 2.5, 1000000, 14375000),
(04, 10, 2022, 5500000, 2.5, 1000000, 14375000),
(04, 11, 2022, 5500000, 2.5, 1000000, 14375000),
(04, 12, 2022, 5500000, 2.5, 1000000, 14375000),
(05, 2, 2022, 5000000, 2.0, 800000, 10000000),
(05, 3, 2022, 5000000, 2.0, 800000, 10000000),
(05, 4, 2022, 5000000, 2.0, 800000, 10000000),
(05, 5, 2022, 5000000, 2.0, 800000, 10000000),
(05, 6, 2022, 5000000, 2.0, 800000, 10000000),
(05, 7, 2022, 5000000, 2.0, 800000, 10000000),
(05, 8, 2022, 5000000, 2.0, 800000, 10000000),
(05, 9, 2022, 5000000, 2.0, 800000, 10000000),
(05, 10, 2022, 5000000, 2.0, 800000, 10000000),
(05, 11, 2022, 5000000, 2.0, 800000, 10000000),
(05, 12, 2022, 5000000, 2.0, 800000, 10000000),
(06, 2, 2022, 7000000, 3.5, 1500000, 28750000),
(06, 3, 2022, 7000000, 3.5, 1500000, 28750000),
(06, 4, 2022, 7000000, 3.5, 1500000, 28750000),
(06, 5, 2022, 7000000, 3.5, 1500000, 28750000),
(06, 6, 2022, 7000000, 3.5, 1500000, 28750000),
(06, 7, 2022, 7000000, 3.5, 1500000, 28750000),
(06, 8, 2022, 7000000, 3.5, 1500000, 28750000),
(06, 9, 2022, 7000000, 3.5, 1500000, 28750000),
(06, 10, 2022, 7000000, 3.5, 1500000, 28750000),
(06, 11, 2022, 7000000, 3.5, 1500000, 28750000),
(06, 12, 2022, 7000000, 3.5, 1500000, 28750000),
(07, 2, 2022, 6500000, 3.0, 1200000, 22100000),
(07, 3, 2022, 6500000, 3.0, 1200000, 22100000),
(07, 4, 2022, 6500000, 3.0, 1200000, 22100000),
(07, 5, 2022, 6500000, 3.0, 1200000, 22100000),
(07, 6, 2022, 6500000, 3.0, 1200000, 22100000),
(07, 7, 2022, 6500000, 3.0, 1200000, 22100000),
(07, 8, 2022, 6500000, 3.0, 1200000, 22100000),
(07, 9, 2022, 6500000, 3.0, 1200000, 22100000),
(07, 10, 2022, 6500000, 3.0, 1200000, 22100000),
(07, 11, 2022, 6500000, 3.0, 1200000, 22100000),
(07, 12, 2022, 6500000, 3.0, 1200000, 22100000),
(08, 2, 2022, 5000000, 2.5, 1000000, 13500000),
(08, 3, 2022, 5000000, 2.5, 1000000, 13500000),
(08, 4, 2022, 5000000, 2.5, 1000000, 13500000),
(08, 5, 2022, 5000000, 2.5, 1000000, 13500000),
(08, 6, 2022, 5000000, 2.5, 1000000, 13500000),
(08, 7, 2022, 5000000, 2.5, 1000000, 13500000),
(08, 8, 2022, 5000000, 2.5, 1000000, 13500000),
(08, 9, 2022, 5000000, 2.5, 1000000, 13500000),
(08, 10, 2022, 5000000, 2.5, 1000000, 13500000),
(08, 11, 2022, 5000000, 2.5, 1000000, 13500000),
(08, 12, 2022, 5000000, 2.5, 1000000, 13500000),
(09, 2, 2022, 4500000, 2.0, 800000, 9800000),
(09, 3, 2022, 4500000, 2.0, 800000, 9800000),
(09, 4, 2022, 4500000, 2.0, 800000, 9800000),
(09, 5, 2022, 4500000, 2.0, 800000, 9800000),
(09, 6, 2022, 4500000, 2.0, 800000, 9800000),
(09, 7, 2022, 4500000, 2.0, 800000, 9800000),
(09, 8, 2022, 4500000, 2.0, 800000, 9800000),
(09, 9, 2022, 4500000, 2.0, 800000, 9800000),
(09, 10, 2022, 4500000, 2.0, 800000, 9800000),
(09, 11, 2022, 4500000, 2.0, 800000, 9800000),
(09, 12, 2022, 4500000, 2.0, 800000, 9800000),
(10, 2, 2022, 6000000, 3.0, 1200000, 20400000),
(10, 3, 2022, 6000000, 3.0, 1200000, 20400000),
(10, 4, 2022, 6000000, 3.0, 1200000, 20400000),
(10, 5, 2022, 6000000, 3.0, 1200000, 20400000),
(10, 6, 2022, 6000000, 3.0, 1200000, 20400000),
(10, 7, 2022, 6000000, 3.0, 1200000, 20400000),
(10, 8, 2022, 6000000, 3.0, 1200000, 20400000),
(10, 9, 2022, 6000000, 3.0, 1200000, 20400000),
(10, 10, 2022, 6000000, 3.0, 1200000, 20400000),
(10, 11, 2022, 6000000, 3.0, 1200000, 20400000),
(10, 12, 2022, 6000000, 3.0, 1200000, 20400000),
(01, 1, 2021, 4000000, 2.0, 800000, 9200000),
       (01, 2, 2021, 4000000, 2.0, 800000, 9200000),
       (01, 3, 2021, 4000000, 2.0, 800000, 9200000),
       (01, 4, 2021, 4000000, 2.0, 800000, 9200000),
       (01, 5, 2021, 4000000, 2.0, 800000, 9200000),
       (01, 6, 2021, 4000000, 2.0, 800000, 9200000),
       (01, 7, 2021, 4000000, 2.0, 800000, 9200000),
       (01, 8, 2021, 4000000, 2.0, 800000, 9200000),
       (01, 9, 2021, 4000000, 2.0, 800000, 9200000),
       (01, 10, 2021, 4000000, 2.0, 800000, 9200000),
       (01, 11, 2021, 4000000, 2.0, 800000, 9200000),
       (01, 12, 2021, 4000000, 2.0, 800000, 9200000),
	   (02, 1, 2021, 5000000, 2.5, 1000000, 13750000),
    (02, 2, 2021, 5000000, 2.5, 1000000, 13750000),
    (02, 3, 2021, 5000000, 2.5, 1000000, 13750000),
    (02, 4, 2021, 5000000, 2.5, 1000000, 13750000),
    (02, 5, 2021, 5000000, 2.5, 1000000, 13750000),
    (02, 6, 2021, 5000000, 2.5, 1000000, 13750000),
    (02, 7, 2021, 5000000, 2.5, 1000000, 13750000),
    (02, 8, 2021, 5000000, 2.5, 1000000, 13750000),
    (02, 9, 2021, 5000000, 2.5, 1000000, 13750000),
    (02, 10, 2021, 5000000, 2.5, 1000000, 13750000),
    (02, 11, 2021, 5000000, 2.5, 1000000, 13750000),
    (02, 12, 2021, 5000000, 2.5, 1000000, 13750000),
    (03, 1, 2021, 6000000, 3.0, 1200000, 19800000),
    (03, 2, 2021, 6000000, 3.0, 1200000, 19800000),
    (03, 3, 2021, 6000000, 3.0, 1200000, 19800000),
    (03, 4, 2021, 6000000, 3.0, 1200000, 19800000),
    (03, 5, 2021, 6000000, 3.0, 1200000, 19800000),
    (03, 6, 2021, 6000000, 3.0, 1200000, 19800000),
    (03, 7, 2021, 6000000, 3.0, 1200000, 19800000),
    (03, 8, 2021, 6000000, 3.0, 1200000, 19800000),
    (03, 9, 2021, 6000000, 3.0, 1200000, 19800000),
    (03, 10, 2021, 6000000, 3.0, 1200000, 19800000),
	(03, 11, 2021, 5000000, 2.5, 1000000, 13750000),
       (03, 12, 2021, 5000000, 2.5, 1000000, 13750000),
	   (05, 1, 2021, 5000000, 2.5, 1000000, 13750000),
(05, 2, 2021, 5000000, 2.5, 1000000, 13750000),
(05, 3, 2021, 5000000, 2.5, 1000000, 13750000),
(05, 4, 2021, 5000000, 2.5, 1000000, 13750000),
(05, 5, 2021, 5000000, 2.5, 1000000, 13750000),
(05, 6, 2021, 5000000, 2.5, 1000000, 13750000),
(05, 7, 2021, 5000000, 2.5, 1000000, 13750000),
(05, 8, 2021, 5000000, 2.5, 1000000, 13750000),
(05, 9, 2021, 5000000, 2.5, 1000000, 13750000),
(05, 10, 2021, 5000000, 2.5, 1000000, 13750000),
(05, 11, 2021, 5000000, 2.5, 1000000, 13750000),
(05, 12, 2021, 5000000, 2.5, 1000000, 13750000),
(08, 1, 2021, 3500000, 2.0, 500000, 8000000),
(08, 2, 2021, 3500000, 2.0, 500000, 8000000),
(08, 3, 2021, 3500000, 2.0, 500000, 8000000),
(08, 4, 2021, 3500000, 2.0, 500000, 8000000),
(08, 5, 2021, 3500000, 2.0, 500000, 8000000),
(08, 6, 2021, 3500000, 2.0, 500000, 8000000),
(08, 7, 2021, 3500000, 2.0, 500000, 8000000),
(08, 8, 2021, 3500000, 2.0, 500000, 8000000),
(08, 9, 2021, 3500000, 2.0, 500000, 8000000),
(08, 10, 2021, 3500000, 2.0, 500000, 8000000),
(08, 11, 2021, 3500000, 2.0, 500000, 8000000),
(08, 12, 2021, 3500000, 2.0, 500000, 8000000),
(09, 1, 2021, 4500000, 1.5, 900000, 7600000),
    (09, 2, 2021, 4500000, 1.5, 900000, 7600000),
    (09, 3, 2021, 4500000, 1.5, 900000, 7600000),
    (09, 4, 2021, 4500000, 1.5, 900000, 7600000),
    (09, 5, 2021, 4500000, 1.5, 900000, 7600000),
    (09, 6, 2021, 4500000, 1.5, 900000, 7600000),
    (09, 7, 2021, 4500000, 1.5, 900000, 7600000),
    (09, 8, 2021, 4500000, 1.5, 900000, 7600000),
    (09, 9, 2021, 4500000, 1.5, 900000, 7600000),
    (09, 10, 2021, 4500000, 1.5, 900000, 7600000),
    (09, 11, 2021, 4500000, 1.5, 900000, 7600000),
    (09, 12, 2021, 4500000, 1.5, 900000, 7600000),
	 (08, 1, 2020, 4500000, 1.8, 800000, 8900000),
    (08, 2, 2020, 4500000, 1.8, 800000, 8900000),
    (08, 3, 2020, 4500000, 1.8, 800000, 8900000),
    (08, 4, 2020, 4500000, 1.8, 800000, 8900000),
    (08, 5, 2020, 4500000, 1.8, 800000, 8900000),
    (08, 6, 2020, 4500000, 1.8, 800000, 8900000),
    (08, 7, 2020, 4500000, 1.8, 800000, 8900000),
    (08, 8, 2020, 4500000, 1.8, 800000, 8900000),
    (08, 9, 2020, 4500000, 1.8, 800000, 8900000),
    (08, 10, 2020, 4500000, 1.8, 800000, 8900000),
    (08, 11, 2020, 4500000, 1.8, 800000, 8900000),
    (08, 12, 2020, 4500000, 1.8, 800000, 8900000),
    (03, 1, 2020, 5500000, 2.0, 900000, 11900000),
    (03, 2, 2020, 5500000, 2.0, 900000, 11900000),
    (03, 3, 2020, 5500000, 2.0, 900000, 11900000),
    (03, 4, 2020, 5500000, 2.0, 900000, 11900000),
    (03, 5, 2020, 5500000, 2.0, 900000, 11900000),
    (03, 6, 2020, 5500000, 2.0, 900000, 11900000),
    (03, 7, 2020, 5500000, 2.0, 900000, 11900000),
    (03, 8, 2020, 5500000, 2.0, 900000, 11900000),
    (03, 9, 2020, 5500000, 2.0, 900000, 11900000),
    (03, 10, 2020, 5500000, 2.0, 900000, 11900000),
    (03, 11, 2020, 5500000, 2.0, 900000, 11900000),
       (03, 12, 2020, 6000000, 2.5, 1000000, 16000000),
	   (02, 1, 2020, 3500000, 2.0, 700000, 7700000),
       (02, 2, 2020, 3500000, 2.0, 700000, 7700000),
       (02, 3, 2020, 3500000, 2.0, 700000, 7700000),
       (02, 4, 2020, 3500000, 2.0, 700000, 7700000),
       (02, 5, 2020, 3500000, 2.0, 700000, 7700000),
       (02, 6, 2020, 3500000, 2.0, 700000, 7700000),
       (02, 7, 2020, 3500000, 2.0, 700000, 7700000),
       (02, 8, 2020, 3500000, 2.0, 700000, 7700000),
       (02, 9, 2020, 3500000, 2.0, 700000, 7700000),
       (02, 10, 2020, 3500000, 2.0, 700000, 7700000),
       (02, 11, 2020, 3500000, 2.0, 700000, 7700000),
       (02, 12, 2020, 3500000, 2.0, 700000, 7700000);
INSERT INTO ChamCong (MaNV, Thang, Nam, Ngay, GioVao, GioRa)
VALUES 
(01, 1, 2022, '2022-01-01', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-02', '08:30:00', '18:30:00'),
(01, 1, 2022, '2022-01-03', '08:30:00', '17:30:00'),
(01, 1, 2022, '2022-01-04', '08:15:00', '17:15:00'),
(01, 1, 2022, '2022-01-05', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-06', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-07', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-08', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-09', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-10', '08:30:00', '17:30:00'),
(01, 1, 2022, '2022-01-11', '08:15:00', '17:15:00'),
(01, 1, 2022, '2022-01-12', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-13', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-14', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-15', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-16', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-17', '08:30:00', '17:30:00'),
(01, 1, 2022, '2022-01-18', '08:15:00', '17:15:00'),
(01, 1, 2022, '2022-01-19', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-20', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-21', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-22', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-23', '08:15:00', '17:30:00'),
(01, 1, 2022, '2022-01-24', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-25', '08:10:00', '17:15:00'),
(01, 1, 2022, '2022-01-26', '08:05:00', '17:10:00'),
(01, 1, 2022, '2022-01-27', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-28', '08:20:00', '17:30:00'),
(01, 1, 2022, '2022-01-29', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-30', '08:00:00', '17:00:00'),
(01, 1, 2022, '2022-01-31', '08:00:00', '17:00:00'),
(02, 1, 2022, '2022-01-01', '08:05:00', '17:00:00');
INSERT INTO ChamCong (MaNV, Thang, Nam, Ngay, GioVao, GioRa)
VALUES 
(02, 1, 2022, '2022-01-02', '08:10:00', '17:05:00'),
       (02, 1, 2022, '2022-01-03', '08:00:00', '19:00:00'),
       (02, 1, 2022, '2022-01-04', '08:03:00', '17:04:00'),
       (02, 1, 2022, '2022-01-05', '08:05:00', '17:02:00'),
       (02, 1, 2022, '2022-01-06', '08:15:00', '17:10:00'),
       (02, 1, 2022, '2022-01-07', '08:08:00', '17:03:00'),
       (02, 1, 2022, '2022-01-08', '08:20:00', '17:15:00'),
       (02, 1, 2022, '2022-01-09', NULL, NULL),
       (02, 1, 2022, '2022-01-10', '08:00:00', '17:00:00'),
       (02, 1, 2022, '2022-01-11', '08:05:00', '17:01:00'),
       (02, 1, 2022, '2022-01-12', '08:07:00', '17:02:00'),
       (02, 1, 2022, '2022-01-13', '08:10:00', '17:10:00'),
       (02, 1, 2022, '2022-01-14', '08:00:00', '17:00:00'),
       (02, 1, 2022, '2022-01-15', NULL, NULL),
       (02, 1, 2022, '2022-01-16', NULL, NULL),
       (02, 1, 2022, '2022-01-17', '08:00:00', '17:00:00'),
	   (02, 1, 2022, '2022-01-18', '08:00:00', '17:00:00'),
       (02, 1, 2022, '2022-01-19', '08:05:00', '17:01:00'),
       (02, 1, 2022, '2022-01-20', '08:07:00', '17:02:00'),
       (02, 1, 2022, '2022-01-21', '08:10:00', '17:10:00'),
	   (02, 1, 2022, '2022-01-22', NULL, NULL),
       (02, 1, 2022, '2022-01-23', NULL, NULL),
       (02, 1, 2022, '2022-01-24', '08:00:00', '17:00:00'),
       (02, 1, 2022, '2022-01-25', '08:05:00', '17:00:00'),
       (02, 1, 2022, '2022-01-26', '08:08:00', '17:03:00'),
       (02, 1, 2022, '2022-01-27', '08:12:00', '17:07:00'),
       (02, 1, 2022, '2022-01-28', '08:18:00', '17:10:00'),
       (02, 1, 2022, '2022-01-29', NULL, NULL),
       (02, 1, 2022, '2022-01-30', NULL, NULL),
       (02, 1, 2022, '2022-01-31', '08:05:00', '17:05:00'),
	   (03, 1, 2022, '2022-01-01', '08:00:00', '17:00:00'),
    (03, 1, 2022, '2022-01-02', '08:15:00', '17:30:00'),
    (03, 1, 2022, '2022-01-03', '08:00:00', '17:50:00'),
    (03, 1, 2022, '2022-01-04', '08:15:00', '17:30:00'),
    (03, 1, 2022, '2022-01-05', '08:20:00', '17:00:00'),
    (03, 1, 2022, '2022-01-06', '08:15:00', '17:30:00'),
    (03, 1, 2022, '2022-01-07', '08:04:00', '17:00:00'),
    (03, 1, 2022, '2022-01-08', NULL, NULL),
    (03, 1, 2022, '2022-01-09', NULL, NULL),
    (03, 1, 2022, '2022-01-10', '08:15:00', '17:30:00'),
    (03, 1, 2022, '2022-01-11', '08:00:00', '17:20:00'),
    (03, 1, 2022, '2022-01-12', '08:15:00', '18:30:00'),
    (03, 1, 2022, '2022-01-13', '08:47:00', '17:00:00'),
    (03, 1, 2022, '2022-01-14', '08:15:00', '17:50:00'),
    (03, 1, 2022, '2022-01-15', '08:00:00', '17:00:00'),
    (03, 1, 2022, '2022-01-16', NULL, NULL),
    (03, 1, 2022, '2022-01-17', NULL, NULL),
    (03, 1, 2022, '2022-01-18', '08:15:00', '19:30:00'),
    (03, 1, 2022, '2022-01-19', '08:00:00', '17:00:00'),
    (03, 1, 2022, '2022-01-20', '08:15:00', '17:30:00'),
	(03, 1, 2022, '2022-01-21', '08:15:00', '17:30:00'),
    (03, 1, 2022, '2022-01-22', '08:00:00', '17:20:00'),
    (03, 1, 2022, '2022-01-23', '08:15:00', '18:30:00'),
    (03, 1, 2022, '2022-01-24', '08:47:00', '17:00:00'),
    (03, 1, 2022, '2022-01-25', '08:15:00', '17:50:00'),
    (03, 1, 2022, '2022-01-26', '08:00:00', '18:00:00'),
    (03, 1, 2022, '2022-01-27', NULL, NULL),
    (03, 1, 2022, '2022-01-28', NULL, NULL),
    (03, 1, 2022, '2022-01-29', '08:15:00', '17:30:00'),
    (03, 1, 2022, '2022-01-30', '08:20:00', '17:56:00'),
(04, 1, 2022, '2022-01-01', '08:30:00', '17:00:00'),
(04, 1, 2022, '2022-01-02', '09:00:00', '18:00:00'),
(04, 1, 2022, '2022-01-03', '07:45:00', '17:30:00'),
(04, 1, 2022, '2022-01-04', '08:15:00', '17:45:00'),
(04, 1, 2022, '2022-01-05', '07:50:00', '17:30:00'),
(04, 1, 2022, '2022-01-06', '08:00:00', '18:30:00'),
(04, 1, 2022, '2022-01-07', NULL, NULL),
(04, 1, 2022, '2022-01-08', '09:15:00', '18:15:00'),
(04, 1, 2022, '2022-01-09', '08:00:00', '17:30:00'),
(04, 1, 2022, '2022-01-10', '07:45:00', '17:15:00'),
(04, 1, 2022, '2022-01-11', '08:30:00', '17:00:00'),
(04, 1, 2022, '2022-01-12', '09:00:00', '17:30:00'),
(04, 1, 2022, '2022-01-13', NULL, NULL),
(04, 1, 2022, '2022-01-14', '08:15:00', '17:15:00'),
(04, 1, 2022, '2022-01-15', '09:30:00', '18:30:00'),
(04, 1, 2022, '2022-01-16', '10:00:00', '18:00:00'),
(04, 1, 2022, '2022-01-17', '07:45:00', '19:45:00'),
(04, 1, 2022, '2022-01-18', '08:15:00', '17:15:00'),
(04, 1, 2022, '2022-01-19', '08:30:00', '18:45:00'),
(04, 1, 2022, '2022-01-20', '07:50:00', '18:30:00'),
(04, 1, 2022, '2022-01-21', '08:00:00', '17:00:00'),
(04, 1, 2022, '2022-02-22', NULL, NULL),
(04, 1, 2022, '2022-02-23', NULL, NULL),
(04, 1, 2022, '2022-01-24', '09:15:00', '18:15:00'),
(04, 1, 2022, '2022-01-25', '08:00:00', '17:30:00'),
(04, 1, 2022, '2022-01-27', '08:30:00', '17:00:00'),
(04, 1, 2022, '2022-01-28', '09:00:00', '17:30:00'),
(04, 1, 2022, '2022-01-29', '08:00:00', '17:30:00'),
(04, 1, 2022, '2022-01-30', '07:45:00', '17:15:00'),
(05, 1, 2022, '2022-01-01', '08:00:00', '17:00:00'),
(05, 1, 2022, '2022-01-02', NULL, NULL),
(05, 1, 2022, '2022-01-03', '08:10:00', '19:10:00'),
(05, 1, 2022, '2022-01-04', '08:00:00', '17:20:00'),
(05, 1, 2022, '2022-01-05', '08:30:00', '17:00:00'),
(05, 1, 2022, '2022-01-06', '08:00:00', '18:30:00'),
(05, 1, 2022, '2022-01-07', '08:00:00', '17:00:00'),
(05, 1, 2022, '2022-01-08', NULL, NULL),
(05, 1, 2022, '2022-01-09', NULL, NULL),
(05, 1, 2022, '2022-01-10', '08:20:00', '17:00:00'),
(05, 1, 2022, '2022-01-11', '08:00:00', '19:00:00'),
(05, 1, 2022, '2022-01-12', '08:00:00', '17:00:00'),
(05, 1, 2022, '2022-01-13', '08:00:00', '18:40:00'),
(05, 1, 2022, '2022-01-14', '08:00:00', '17:00:00'),
(05, 1, 2022, '2022-01-15', NULL, NULL),
(05, 1, 2022, '2022-01-16', NULL, NULL),
(05, 1, 2022, '2022-01-17', '08:30:00', '17:00:00'),
(05, 1, 2022, '2022-01-18', '08:00:00', '19:00:00'),
(05, 1, 2022, '2022-01-19', '08:00:00', '17:50:00'),
(05, 1, 2022, '2022-01-20', '08:00:00', '17:00:00'),
(05, 1, 2022, '2022-01-21', '08:00:00', '17:00:00'),
(05, 1, 2022, '2022-01-22', NULL, NULL),
(05, 1, 2022, '2022-01-23', NULL, NULL),
(05, 1, 2022, '2022-01-24', '08:00:00', '20:00:00'),
(05, 1, 2022, '2022-01-25', '08:30:00', '17:00:00'),
(05, 1, 2022, '2022-01-26', '08:00:00', '18:30:00'),
(05, 1, 2022, '2022-01-27', '08:00:00', '17:00:00'),
(05, 1, 2022, '2022-01-28', NULL, NULL),
(05, 1, 2022, '2022-01-29', NULL, NULL),
(05, 1, 2022, '2022-01-30', '08:20:00', '17:00:00'),
(06, 1, 2022, '2022-01-01', '08:00:00', '17:00:00'),
(06, 1, 2022, '2022-01-02', '08:00:00', '17:00:00'),
(06, 1, 2022, '2022-01-03', NULL, NULL),
(06, 1, 2022, '2022-01-04', '08:10:00', '17:20:00'),
(06, 1, 2022, '2022-01-05', '08:15:00', '17:30:00'),
(06, 1, 2022, '2022-01-06', '08:00:00', '17:00:00'),
(06, 1, 2022, '2022-01-07', '08:00:00', '17:30:00'),
(06, 1, 2022, '2022-01-08', '08:00:00', '17:00:00'),
(06, 1, 2022, '2022-01-09', '08:00:00', '18:00:00'),
(06, 1, 2022, '2022-01-10', '08:00:00', '17:00:00'),
(06, 1, 2022, '2022-01-11', '08:00:00', '17:00:00'),
(06, 1, 2022, '2022-01-12', '08:00:00', '17:00:00'),
(06, 1, 2022, '2022-01-13', '08:00:00', '17:30:00'),
(06, 1, 2022, '2022-01-14', '08:15:00', '17:50:00'),
(06, 1, 2022, '2022-01-15', '08:00:00', '17:00:00'),
    (06, 1, 2022, '2022-01-16', NULL, NULL),
    (06, 1, 2022, '2022-01-17', NULL, NULL),
    (06, 1, 2022, '2022-01-18', '08:15:00', '19:30:00'),
    (06, 1, 2022, '2022-01-19', '08:00:00', '17:00:00'),
    (06, 1, 2022, '2022-01-20', '08:15:00', '17:30:00'),
	(06, 1, 2022, '2022-01-21', '08:15:00', '17:30:00'),
    (06, 1, 2022, '2022-01-22', '08:00:00', '17:20:00'),
    (06, 1, 2022, '2022-01-23', '08:15:00', '18:30:00'),
    (06, 1, 2022, '2022-01-24', '08:47:00', '17:00:00'),
    (06, 1, 2022, '2022-01-25', '08:15:00', '17:50:00'),
    (06, 1, 2022, '2022-01-26', '08:00:00', '18:00:00'),
    (06, 1, 2022, '2022-01-27', NULL, NULL),
    (06, 1, 2022, '2022-01-28', NULL, NULL),
    (06, 1, 2022, '2022-01-29', '08:15:00', '17:30:00'),
    (06, 1, 2022, '2022-01-30', '08:20:00', '17:56:00'),
	(07, 1, 2022, '2022-01-01', '08:00:00', '17:00:00'),
(07, 1, 2022, '2022-01-02', '08:00:00', '17:00:00'),
(07, 1, 2022, '2022-01-03', '08:30:00', '17:30:00'),
(07, 1, 2022, '2022-01-04', '08:15:00', '17:15:00'),
(07, 1, 2022, '2022-01-05', '08:00:00', '17:00:00'),
(07, 1, 2022, '2022-01-06', '08:00:00', '17:00:00'),
(07, 1, 2022, '2022-01-07', '08:00:00', '17:00:00'),
(07, 1, 2022, '2022-01-08', '08:00:00', '17:00:00'),
(07, 1, 2022, '2022-01-09', '08:00:00', '17:00:00'),
(07, 1, 2022, '2022-01-10', '08:30:00', '17:30:00'),
(07, 1, 2022, '2022-01-11', '08:00:00', '19:00:00'),
(07, 1, 2022, '2022-01-12', '08:00:00', '17:00:00'),
(07, 1, 2022, '2022-01-13', '08:00:00', '18:40:00'),
(07, 1, 2022, '2022-01-14', '08:00:00', '17:00:00'),
(07, 1, 2022, '2022-01-15', NULL, NULL),
(07, 1, 2022, '2022-01-16', NULL, NULL),
(07, 1, 2022, '2022-01-17', '08:30:00', '17:00:00'),
(07, 1, 2022, '2022-01-18', '08:00:00', '19:00:00'),
(07, 1, 2022, '2022-01-19', '08:00:00', '17:50:00'),
(07, 1, 2022, '2022-01-20', '08:00:00', '17:00:00'),
(07, 1, 2022, '2022-01-21', '08:00:00', '17:00:00'),
(07, 1, 2022, '2022-01-22', NULL, NULL),
(07, 1, 2022, '2022-01-23', NULL, NULL),
(07, 1, 2022, '2022-01-24', '08:00:00', '20:00:00'),
(07, 1, 2022, '2022-01-25', '08:30:00', '17:00:00'),
(07, 1, 2022, '2022-01-26', '08:00:00', '18:30:00'),
(07, 1, 2022, '2022-01-27', '08:00:00', '17:00:00'),
(07, 1, 2022, '2022-01-28', NULL, NULL),
(07, 1, 2022, '2022-01-29', NULL, NULL),
(07, 1, 2022, '2022-01-30', '08:20:00', '17:00:00'),
(08, 1, 2022, '2022-01-01', '07:55:00', '17:55:00'),
(08, 1, 2022, '2022-01-02', '08:05:00', '17:00:00'),
(08, 1, 2022, '2022-01-03', '08:02:00', '17:00:00'),
( 08, 1, 2022, '2022-01-04', '08:10:00', '18:00:00'),
(08, 1, 2022, '2022-01-05', '07:50:00', '17:15:00'),
(08, 1, 2022, '2022-01-06', '08:05:00', '17:10:00'),
(08, 1, 2022, '2022-01-07', '08:00:00', '18:50:00'),
(08, 1, 2022, '2022-01-08', NULL, NULL),
(08, 1, 2022, '2022-01-09', NULL, NULL),
(08, 1, 2022, '2022-01-10', '07:58:00', '18:57:00'),
(08, 1, 2022, '2022-01-11', '08:00:00', '19:00:00'),
(08, 1, 2022, '2022-01-12', '08:00:00', '17:00:00'),
(08, 1, 2022, '2022-01-13', '08:00:00', '18:40:00'),
(08, 1, 2022, '2022-01-14', '08:00:00', '17:00:00'),
(08, 1, 2022, '2022-01-15', NULL, NULL),
(08, 1, 2022, '2022-01-16', NULL, NULL),
(08, 1, 2022, '2022-01-17', '08:30:00', '17:00:00'),
(08, 1, 2022, '2022-01-18', '08:00:00', '19:00:00'),
(08, 1, 2022, '2022-01-19', '08:00:00', '17:50:00'),
(08, 1, 2022, '2022-01-20', '08:00:00', '17:00:00'),
(08, 1, 2022, '2022-01-21', '08:00:00', '17:00:00'),
(08, 1, 2022, '2022-01-22', NULL, NULL),
(08, 1, 2022, '2022-01-23', NULL, NULL),
(08, 1, 2022, '2022-01-24', '08:00:00', '20:00:00'),
(08, 1, 2022, '2022-01-25', '08:30:00', '17:00:00'),
(08, 1, 2022, '2022-01-26', '08:00:00', '18:30:00'),
(08, 1, 2022, '2022-01-27', '08:00:00', '17:00:00'),
(08, 1, 2022, '2022-01-28', NULL, NULL),
(08, 1, 2022, '2022-01-29', NULL, NULL),
(08, 1, 2022, '2022-01-30', '08:20:00', '17:00:00'),
(09, 1, 2022, '2022-01-02', '08:00:00', '17:00:00'),
(09, 1, 2022, '2022-01-03', '08:30:00', '17:30:00'),
(09, 1, 2022, '2022-01-04', '08:15:00', '17:15:00'),
(09, 1, 2022, '2022-01-05', '08:00:00', '17:00:00'),
(09, 1, 2022, '2022-01-06', '08:00:00', '17:00:00'),
(09, 1, 2022, '2022-01-07', '08:00:00', '17:00:00'),
(09, 1, 2022, '2022-01-08', '08:00:00', '17:00:00'),
(09, 1, 2022, '2022-01-09', '08:00:00', '17:00:00'),
(09, 1, 2022, '2022-01-10', '08:30:00', '17:30:00'),
(09, 1, 2022, '2022-01-11', '08:00:00', '19:00:00'),
(09, 1, 2022, '2022-01-12', '08:00:00', '17:00:00'),
(09, 1, 2022, '2022-01-13', '08:00:00', '18:40:00'),
(09, 1, 2022, '2022-01-14', '08:00:00', '17:00:00'),
(09, 1, 2022, '2022-01-15', NULL, NULL),
(09, 1, 2022, '2022-01-16', NULL, NULL),
    (09, 1, 2022, '2022-01-17', NULL, NULL),
    (09, 1, 2022, '2022-01-18', '08:15:00', '19:30:00'),
    (09, 1, 2022, '2022-01-19', '08:00:00', '17:00:00'),
    (09, 1, 2022, '2022-01-20', '08:15:00', '17:30:00'),
	(09, 1, 2022, '2022-01-21', '08:15:00', '17:30:00'),
    (09, 1, 2022, '2022-01-22', '08:00:00', '17:20:00'),
    (09, 1, 2022, '2022-01-23', '08:15:00', '18:30:00'),
    (09, 1, 2022, '2022-01-24', '08:47:00', '17:00:00'),
    (09, 1, 2022, '2022-01-25', '08:15:00', '17:50:00'),
    (09, 1, 2022, '2022-01-26', '08:00:00', '18:00:00'),
    (09, 1, 2022, '2022-01-27', NULL, NULL),
    (09, 1, 2022, '2022-01-28', NULL, NULL),
    (09, 1, 2022, '2022-01-29', '08:15:00', '17:30:00'),
    (09, 1, 2022, '2022-01-30', '08:20:00', '17:56:00'),
	(10, 1, 2022, '2022-01-01', '08:00:00', '17:00:00'),
(10, 1, 2022, '2022-01-02', '08:50:00', '19:30:00'),
(10, 1, 2022, '2022-01-03', NULL, NULL),
(10, 1, 2022, '2022-01-04', '08:10:00', '17:20:00'),
(10, 1, 2022, '2022-01-05', '08:15:00', '17:30:00'),
(10, 1, 2022, '2022-01-06', '08:00:00', '17:00:00'),
(10, 1, 2022, '2022-01-07', '08:00:00', '17:30:00'),
(10, 1, 2022, '2022-01-08', '08:00:00', '17:00:00'),
(10, 1, 2022, '2022-01-09', '08:00:00', '18:00:00'),
(10, 1, 2022, '2022-01-10', '08:00:00', '17:00:00'),
(10, 1, 2022, '2022-01-11', '08:00:00', '17:00:00'),
(10, 1, 2022, '2022-01-12', '08:00:00', '17:00:00'),
(10, 1, 2022, '2022-01-13', '08:00:00', '18:40:00'),
(10, 1, 2022, '2022-01-14', '08:00:00', '17:00:00'),
(10, 1, 2022, '2022-01-15', NULL, NULL),
(10, 1, 2022, '2022-01-16', '08:46:00', '20:10:00'),
    (10, 1, 2022, '2022-01-17', NULL, NULL),
    (10, 1, 2022, '2022-01-18', '08:15:00', '19:30:00'),
    (10, 1, 2022, '2022-01-19', '08:00:00', '17:00:00'),
    (10, 1, 2022, '2022-01-20', '08:15:00', '17:30:00'),
	(10, 1, 2022, '2022-01-21', '08:15:00', '17:30:00'),
    (10, 1, 2022, '2022-01-22', '08:00:00', '17:20:00'),
    (10, 1, 2022, '2022-01-23', '08:15:00', '18:30:00'),
	(10, 1, 2022, '2022-01-24', '09:15:00', '18:15:00'),
(10, 1, 2022, '2022-01-25', '08:00:00', '17:30:00'),
(10, 1, 2022, '2022-01-27', '08:30:00', '17:00:00'),
(10, 1, 2022, '2022-01-28', '09:00:00', '17:30:00'),
(10, 1, 2022, '2022-01-29', '08:00:00', '17:30:00'),
(10, 1, 2022, '2022-01-30', '07:45:00', '17:15:00');

-- cham cong

-- giờ vào

-- tìm kiếm theo ngày
SELECT nv.MaNV, nv.HoTenNV, cc.Ngay, CONVERT(varchar(8), cc.GioVao, 108) as GioVao
FROM ChamCong cc
JOIN nhanvien nv ON cc.MaNV = nv.MaNV
WHERE cc.Ngay = '2022-01-15'
ORDER BY cc.Ngay, cc.GioVao

-- tìm kiếm theo mã
SELECT nv.MaNV, nv.HoTenNV, cc.Ngay, CONVERT(varchar(8), cc.GioVao, 108) as GioVao
FROM ChamCong cc
JOIN nhanvien nv ON cc.MaNV = nv.MaNV
WHERE cc.MaNV = '1' AND cc.Ngay = '2022-01-15'
ORDER BY cc.Ngay, cc.GioVao

-- tìm kiếm theo tên
SELECT nv.MaNV, nv.HoTenNV, cc.Ngay, CONVERT(varchar(8), cc.GioVao, 108) as GioVao
FROM ChamCong cc
JOIN nhanvien nv ON cc.MaNV = nv.MaNV
WHERE nv.HoTenNV = 'Lê Quang Minh' AND cc.Ngay = '2022-01-15'
ORDER BY cc.Ngay, cc.GioVao

-- giờ ra 

--tìm kiếm theo ngày
SELECT nv.MaNV, nv.HoTenNV, cc.Ngay, CONVERT(varchar(8), cc.GioRa, 108) as GioRa
FROM ChamCong cc
JOIN nhanvien nv ON cc.MaNV = nv.MaNV
WHERE cc.Ngay = '2022-01-5'
ORDER BY cc.Ngay, cc.GioRa

-- tìm kiếm theo mã
SELECT nv.MaNV, nv.HoTenNV, cc.Ngay, CONVERT(varchar(8), cc.GioRa, 108) as GioRa
FROM ChamCong cc
JOIN nhanvien nv ON cc.MaNV = nv.MaNV
WHERE cc.MaNV = '2' AND cc.Ngay = '2022-01-15'
ORDER BY cc.Ngay, cc.GioRa

 -- tìm kiếm theo tên
SELECT nv.MaNV, nv.HoTenNV, cc.Ngay, CONVERT(varchar(8), cc.GioRa, 108) as GioRa
FROM ChamCong cc
JOIN nhanvien nv ON cc.MaNV = nv.MaNV
WHERE nv.HoTenNV = 'Lê Quang Minh' AND cc.Ngay = '2022-01-15'
ORDER BY cc.Ngay, cc.GioRa

-- Bảng Tổng chấm công

	SELECT 
    nhanvien.MaNV, 
    nhanvien.HoTenNV, 
    ChamCong.Thang, 
    ChamCong.Nam, 
    ChamCong.Ngay, 
    CONVERT(TIME(0), ChamCong.GioVao, 108) AS GioVao,
    CONVERT(TIME(0), ChamCong.GioRa, 108) AS GioRa,
    FORMAT(
        CASE 
            WHEN ChamCong.GioVao IS NOT NULL AND CAST(ChamCong.GioVao AS TIME) > CAST('08:00:00' AS TIME) 
                THEN IIF(DATEDIFF(minute, CAST('08:00:00' AS TIME), CAST(ChamCong.GioVao AS TIME)) <= 15, 50000,
                    IIF(DATEDIFF(minute, CAST('08:00:00' AS TIME), CAST(ChamCong.GioVao AS TIME)) <= 30, 100000,
                        IIF(DATEDIFF(minute, CAST('08:00:00' AS TIME), CAST(ChamCong.GioVao AS TIME)) <= 60, 200000, 0)))
            ELSE 0
        END, 'N0'
    ) AS PhatDiMuon,
    CASE
    WHEN (
        SELECT COUNT(*) 
        FROM ChamCong AS cc 
        WHERE cc.MaNV = ChamCong.MaNV AND cc.Thang = ChamCong.Thang AND cc.Nam = ChamCong.Nam AND cc.Ngay < ChamCong.Ngay AND cc.GioVao IS NULL
    ) >= 4 THEN 
        CASE 
            WHEN ChamCong.GioVao IS NULL THEN 300000
            ELSE 0
        END
    ELSE 0
END AS PhatNghi,
    FORMAT(
        CASE 
            WHEN ChamCong.GioRa IS NOT NULL AND CAST(ChamCong.GioRa AS TIME) > CAST('17:00:00' AS TIME) 
                THEN DATEDIFF(minute, CAST('17:00:00' AS TIME), CAST(ChamCong.GioRa AS TIME)) / 60.0 * 100000
            ELSE 0
        END, 'N0'
    ) AS TienTangCa
FROM 
    nhanvien 
    JOIN ChamCong ON nhanvien.MaNV = ChamCong.MaNV 
WHERE 
    nhanvien.MaNV = '3' AND ChamCong.Thang = 1 AND ChamCong.Nam = 2022;


	-- Bảng Nhân VIên 
	SELECT DISTINCT nhanvien.MaNV, nhanvien.HoTenNV, nhanvien.GioiTinh, nhanvien.NgaySinh, nhanvien.DiaChi, nhanvien.ChucVu, nhanvien.CMND, nhanvien.SDT, nhanvien.Email, nhanvien.MaBoPhan, LUONG.LuongCB, LUONG.HeSoLuong, LUONG.PhuCap
FROM nhanvien
INNER JOIN LUONG ON nhanvien.MaNV = LUONG.MaNV
where LUONG.Thang = 1 and LUONG.Nam = 2022;


	-- Danh Sách Nhân Viên
	select * from NhanVien

	--thêm nhân viên  và lương 
	INSERT INTO nhanvien (MaNV, HoTenNV, GioiTinh, NgaySinh, DiaChi, ChucVu, CMND, SDT, Email, MaBoPhan)
VALUES ('31', 'Nguyen Van A', 'Nam', '1990-01-01', 'Ha Noi', 'Nhan vien van phong', '123456789', '0901234567', 'nguyenvana@gmail.com', '1')

INSERT INTO LUONG (MaNV, Thang, Nam, LuongCB, HeSoLuong, PhuCap, TongLuong)
VALUES ('NV001', 3, 2023, 10000000, 2.0, 5000000, 25000000);


-- Sửa Nhân viên

	UPDATE nhanvien
SET DiaChi = '123 đường ABC, Quận 1, TP.HCM'
WHERE MaNV = '21';

UPDATE LUONG
SET LuongCB = 15000000, HeSoLuong = 2.5, PhuCap = 3000000, TongLuong = 15000000 * 2.5 + 3000000
WHERE MaNV = '1'



-- Xóa Nhân Viên 

DELETE FROM nhanvien
WHERE MaNV = 'ma_nv_can_xoa';

-- tìm kiếm bảng nhân viên 
 
 -- tìm kiếm theo tên 

 SELECT * FROM nhanvien WHERE HoTenNV LIKE '%Nam%';
 -- theo bộ phận 

SELECT * FROM nhanvien WHERE MaBoPhan = 1;
-- theo mã 
select * from nhanvien where Manv = 1


-- Bảng Bộ Phận
 select * from Bo_Phan


 --thống kê số luọng nhân viên theo bộ phận
SELECT Bo_Phan.TenBoPhan, COUNT(*) AS SoLuongNV
FROM nhanvien
INNER JOIN Bo_Phan ON nhanvien.MaBoPhan = Bo_Phan.MaBoPhan
GROUP BY Bo_Phan.TenBoPhan;

--  ds nhân viên từng bộ phận 
SELECT * FROM nhanvien WHERE MaBoPhan = 1;

-- bảng lương 

-- phạt 

WITH temp AS (
    SELECT
        MaNV,
        Thang,
        Nam,
        Ngay,
        (
            SELECT COUNT(*)
            FROM ChamCong AS cc
            WHERE cc.MaNV = ChamCong.MaNV
                AND cc.Thang = ChamCong.Thang
                AND cc.Nam = ChamCong.Nam
                AND cc.Ngay < ChamCong.Ngay
                AND cc.GioVao IS NULL
        ) AS CountGioVaoNull,
        (
            SELECT COUNT(*)
            FROM ChamCong AS cc
            WHERE cc.MaNV = ChamCong.MaNV
                AND cc.Thang = ChamCong.Thang
                AND cc.Nam = ChamCong.Nam
                AND cc.Ngay = ChamCong.Ngay
                AND cc.GioVao IS NOT NULL
                AND CAST(cc.GioVao AS TIME) > CAST('08:00:00' AS TIME)
        ) AS CountDiMuon
    FROM ChamCong
)
SELECT
    nhanvien.MaNV,
    nhanvien.HoTenNV,
    FORMAT(SUM(
        CASE
            WHEN temp.CountGioVaoNull >= 4
                THEN
                    CASE
                        WHEN ChamCong.GioVao IS NULL
                            THEN 300000
                        ELSE 0
                    END
            ELSE 0
        END
    ), 'N0') AS TongPhatNghi,
    FORMAT(SUM(
        CASE
            WHEN ChamCong.GioRa IS NOT NULL
                AND CAST(ChamCong.GioRa AS TIME) > CAST('17:00:00' AS TIME)
                    THEN DATEDIFF(minute, CAST('17:00:00' AS TIME), CAST(ChamCong.GioRa AS TIME)) / 60.0 * 100000
            ELSE 0
        END
    ), 'N0') AS TongTangCa,
    FORMAT(SUM(
        CASE
            WHEN ChamCong.GioVao IS NOT NULL
                AND CAST(ChamCong.GioVao AS TIME) > CAST('08:00:00' AS TIME)
                    THEN IIF(DATEDIFF(minute, CAST('08:00:00' AS TIME), CAST(ChamCong.GioVao AS TIME)) <= 15, 50000,
                        IIF(DATEDIFF(minute, CAST('08:00:00' AS TIME), CAST(ChamCong.GioVao AS TIME)) <= 30, 100000,
                            IIF(DATEDIFF(minute, CAST('08:00:00' AS TIME), CAST(ChamCong.GioVao AS TIME)) <= 60, 200000, 0)))
            ELSE 0
        END
    ), 'N0') AS PhatDiMuon
FROM
    nhanvien
    JOIN ChamCong ON nhanvien.MaNV = ChamCong.MaNV
    JOIN temp ON ChamCong.MaNV = temp.MaNV
        AND ChamCong.Thang = temp.Thang
        AND ChamCong.Nam = temp.Nam
        AND ChamCong.Ngay = temp.Ngay
WHERE
    ChamCong.Thang = 1
    AND ChamCong.Nam = 2022
GROUP BY
    nhanvien.MaNV,
    nhanvien.HoTenNV;

	-- tổng phạt 
WITH temp AS (
SELECT
MaNV,
Thang,
Nam,
Ngay,
(
SELECT COUNT(*)
FROM ChamCong AS cc
WHERE cc.MaNV = ChamCong.MaNV
AND cc.Thang = ChamCong.Thang
AND cc.Nam = ChamCong.Nam
AND cc.Ngay < ChamCong.Ngay
AND cc.GioVao IS NULL
) AS CountGioVaoNull,
(
SELECT COUNT(*)
FROM ChamCong AS cc
WHERE cc.MaNV = ChamCong.MaNV
AND cc.Thang = ChamCong.Thang
AND cc.Nam = ChamCong.Nam
AND cc.Ngay = ChamCong.Ngay
AND cc.GioVao IS NOT NULL
AND CAST(cc.GioVao AS TIME) > CAST('08:00:00' AS TIME)
) AS CountDiMuon
FROM ChamCong
)
SELECT
nhanvien.MaNV,
nhanvien.HoTenNV,
FORMAT(SUM(
CASE
WHEN temp.CountGioVaoNull >= 4
THEN
CASE
WHEN ChamCong.GioVao IS NULL
THEN 300000
ELSE 0
END
ELSE 0
END
) 
+ SUM(
CASE
WHEN ChamCong.GioRa IS NOT NULL
AND CAST(ChamCong.GioRa AS TIME) > CAST('17:00:00' AS TIME)
THEN DATEDIFF(minute, CAST('17:00:00' AS TIME), CAST(ChamCong.GioRa AS TIME)) / 60.0 * 100000
ELSE 0
END
) 
+ SUM(
CASE
WHEN ChamCong.GioVao IS NOT NULL
AND CAST(ChamCong.GioVao AS TIME) > CAST('08:00:00' AS TIME)
THEN IIF(DATEDIFF(minute, CAST('08:00:00' AS TIME), CAST(ChamCong.GioVao AS TIME)) <= 15, 50000,
IIF(DATEDIFF(minute, CAST('08:00:00' AS TIME), CAST(ChamCong.GioVao AS TIME)) <= 30, 100000,
IIF(DATEDIFF(minute, CAST('08:00:00' AS TIME), CAST(ChamCong.GioVao AS TIME)) <= 60, 200000, 0)))
ELSE 0
END
), 'N0') AS TongLuong
FROM ChamCong
INNER JOIN nhanvien ON ChamCong.MaNV = nhanvien.MaNV
INNER JOIN temp ON ChamCong.MaNV = temp.MaNV AND ChamCong.Thang = temp.Thang AND ChamCong.Nam = temp.Nam AND ChamCong.Ngay = temp.Ngay
GROUP BY nhanvien.MaNV, nhanvien.HoTenNV;


-- bảng lương
select * from LUONG
-- theo mã 
select * from LUONG 
WHERE MaNV = '1' AND Thang = 1 AND Nam = 2022;

-- theo tháng
select * from LUONG 
WHERE Thang = 1 AND Nam = 2022;
-- theo năm
select * from LUONG
where Nam = 2020
--







-- thêm nếu cần thiết 

3//lấy danh sách các bộ phận và số lượng nhân viên của mỗi bộ phận có lương trung bình hơn 8tr
SELECT Bo_Phan.TenBoPhan, COUNT(nhanvien.MaNV) AS SoLuongNhanVien, AVG(LUONG.TongLuong) AS LuongTrungBinh
FROM Bo_Phan
JOIN nhanvien ON Bo_Phan.MaBoPhan = nhanvien.MaBoPhan
JOIN LUONG ON nhanvien.MaNV = LUONG.MaNV
GROUP BY Bo_Phan.TenBoPhan
HAVING AVG(LUONG.TongLuong) > 8000000;

4// thông tin nhân viên lương cao nhất
SELECT TOP 1 * FROM nhanvien
INNER JOIN LUONG ON nhanvien.MaNV = LUONG.MaNV
ORDER BY TongLuong DESC

5//thông tin nhân viên có tuổi từ 25-30
SELECT * FROM nhanvien
WHERE DATEDIFF(YEAR, NgaySinh, GETDATE()) BETWEEN 25 AND 30;

6// thông tin nv có lương trên 10tr
SELECT * FROM nhanvien
WHERE MaNV IN (SELECT MaNV FROM LUONG WHERE TongLuong > 10000000);

7//thống kê số luọng nhân viên theo bộ phận
SELECT Bo_Phan.TenBoPhan, COUNT(*) AS SoLuongNV
FROM nhanvien
INNER JOIN Bo_Phan ON nhanvien.MaBoPhan = Bo_Phan.MaBoPhan
GROUP BY Bo_Phan.TenBoPhan;

8// xếp danh sách nhân viên theo tên và thứ tự giảm dần của lương
SELECT nhanvien.*, LUONG.TongLuong
FROM nhanvien
INNER JOIN LUONG ON nhanvien.MaNV = LUONG.MaNV
ORDER BY nhanvien.HoTenNV ASC, LUONG.TongLuong DESC;

//9 tìm kiếm thông tin nhân viên theo tên hoặc mã bộ phận
SELECT * FROM nhanvien WHERE HoTenNV LIKE '%Nguyen%';

SELECT * FROM nhanvien WHERE MaBoPhan = 1;


//12 cập nhật thông tin lương của nhân viên
UPDATE LUONG
SET LuongCB = 15000000, HeSoLuong = 2.5, PhuCap = 3000000, TongLuong = 15000000 * 2.5 + 3000000
WHERE MaNV = '11' AND Thang = 1 AND Nam = 2022;

//13 tìm nhân viên sinh tháng 1 và lương nhân viên đó
SELECT nhanvien.*, LUONG.*
FROM nhanvien
JOIN LUONG ON nhanvien.MaNV = LUONG.MaNV
WHERE MONTH(nhanvien.NgaySinh) = 1 AND LUONG.Thang = 1;
// 14 thêm thông tin nhân viên vaf lương
INSERT INTO nhanvien (MaNV, HoTenNV, GioiTinh, NgaySinh, DiaChi, ChucVu, CMND, SDT, Email, MaBoPhan)
VALUES ('33', 'Tran Van Kien', 'Nam', '1990-01-01', 'Ha Noi', 'Nhan vien', '123456789', '0987654321', 'nva@gmail.com', 1);

INSERT INTO LUONG (MaNV, Thang, Nam, LuongCB, HeSoLuong, PhuCap, TongLuong)
VALUES ('NV001', 3, 2023, 10000000, 2.0, 5000000, 25000000);

-- Cập nhật thông tin nhân viên 02 và lương của người đó trong cùng một lệnh UPDATE


--Có thể gộp 2 lệnh SQL tính tổng lương và số giờ làm việc của nhân viên mã 01 trong năm lại thành 1 lệnh SQL như sau:

SELECT SUM(LUONG.TongLuong) AS TongLuongNam, COUNT(ChamCong.MaNV) AS SoGioLamViec
FROM LUONG
INNER JOIN ChamCong ON LUONG.MaNV = ChamCong.MaNV AND LUONG.Thang = ChamCong.Thang AND LUONG.Nam = ChamCong.Nam
WHERE LUONG.MaNV = '01' AND LUONG.Nam = 2022

UPDATE nhanvien.nv
INNER JOIN LUONG l ON nv.MaNV = l.MaNV
SET nv.HoTenNV = 'Nguyen Van C', nv.GioiTinh = 'Nu', nv.DiaChi = 'Hai Duong', nv.ChucVu = 'Nhan Vien',
    l.LuongCB = 8000000, l.HeSoLuong = 4, l.PhuCap = 3000000
WHERE nv.MaNV = '02' AND l.Thang = 3 AND l.Nam = 2023;

//tìm thông tin của nhân viên 10 làm việc trong 1 tháng
SELECT cc.MaNV, nv.HoTenNV, cc.Ngay, CONVERT(varchar(8), cc.GioVao, 108) as GioVao, CONVERT(varchar(8), cc.GioRa, 108) as GioRa
FROM ChamCong cc
JOIN nhanvien nv ON cc.MaNV = nv.MaNV
WHERE cc.MaNV = '10'
ORDER BY cc.MaNV, nv.HoTenNV, cc.Ngay, cc.GioVao, cc.GioRa





-- học đến đây thôi 




WITH temp AS (
SELECT
MaNV,
Thang,
Nam,
Ngay,
(
SELECT COUNT(*)
FROM ChamCong AS cc
WHERE cc.MaNV = ChamCong.MaNV AND cc.Thang = ChamCong.Thang AND cc.Nam = ChamCong.Nam AND cc.Ngay < ChamCong.Ngay AND cc.GioVao IS NULL
) AS CountGioVaoNull
FROM ChamCong
)
SELECT
nhanvien.MaNV,
nhanvien.HoTenNV,
SUM(
CASE
WHEN temp.CountGioVaoNull >= 4 THEN
CASE
WHEN ChamCong.GioVao IS NULL THEN 300000
ELSE 0
END
ELSE 0
END
) AS TongPhatNghi,
format (
SUM(
CASE
WHEN ChamCong.GioRa IS NOT NULL AND CAST(ChamCong.GioRa AS TIME) > CAST('17:00:00' AS TIME)
THEN DATEDIFF(minute, CAST('17:00:00' AS TIME), CAST(ChamCong.GioRa AS TIME)) / 60.0 * 100000
ELSE 0
END
),'N0'
) AS TongTangCa
FROM
nhanvien
JOIN ChamCong ON nhanvien.MaNV = ChamCong.MaNV
JOIN temp ON ChamCong.MaNV = temp.MaNV AND ChamCong.Thang = temp.Thang AND ChamCong.Nam = temp.Nam AND ChamCong.Ngay = temp.Ngay
WHERE
ChamCong.Thang = 1 AND ChamCong.Nam = 2022
GROUP BY
nhanvien.MaNV,
nhanvien.HoTenNV;




SELECT nhanvien.MaNV,
nhanvien.HoTenNV,
ChamCong.Thang,
ChamCong.Nam,
SUM(
CASE
WHEN ChamCong.GioVao IS NOT NULL AND CAST(ChamCong.GioVao AS TIME) > CAST('08:00:00' AS TIME)
THEN IIF(DATEDIFF(minute, CAST('08:00:00' AS TIME), CAST(ChamCong.GioVao AS TIME)) <= 15, 50000,
IIF(DATEDIFF(minute, CAST('08:00:00' AS TIME), CAST(ChamCong.GioVao AS TIME)) <= 30, 100000,
IIF(DATEDIFF(minute, CAST('08:00:00' AS TIME), CAST(ChamCong.GioVao AS TIME)) <= 60, 200000, 0)))
ELSE 0
END
) AS TongPhatDiMuon,
SUM(
CASE
WHEN (
SELECT COUNT(*)
FROM ChamCong AS cc
WHERE cc.MaNV = ChamCong.MaNV AND cc.Thang = ChamCong.Thang AND cc.Nam = ChamCong.Nam AND cc.Ngay < ChamCong.Ngay AND cc.GioVao IS NULL
) >= 4 THEN
CASE
WHEN ChamCong.GioVao IS NULL THEN 300000
ELSE 0
END
ELSE 0
END
) AS TongPhatNghi,
SUM(
CASE
WHEN ChamCong.GioRa IS NOT NULL AND CAST(ChamCong.GioRa AS TIME) > CAST('17:00:00' AS TIME)
THEN DATEDIFF(minute, CAST('17:00:00' AS TIME), CAST(ChamCong.GioRa AS TIME)) / 60.0 * 100000
ELSE 0
END
) AS TongTienTangCa
FROM nhanvien
JOIN ChamCong ON nhanvien.MaNV = ChamCong.MaNV
GROUP BY nhanvien.MaNV, nhanvien.HoTenNV, ChamCong.Thang, ChamCong.Nam;



WITH temp AS (
SELECT
MaNV,
Thang,
Nam,
Ngay,
(
SELECT COUNT(*)
FROM ChamCong AS cc
WHERE cc.MaNV = ChamCong.MaNV AND cc.Thang = ChamCong.Thang AND cc.Nam = ChamCong.Nam AND cc.Ngay < ChamCong.Ngay AND cc.GioVao IS NULL
) AS CountGioVaoNull
FROM ChamCong
)
SELECT
nhanvien.MaNV,
nhanvien.HoTenNV,
SUM(
CASE
WHEN temp.CountGioVaoNull >= 4 THEN
CASE
WHEN ChamCong.GioVao IS NULL THEN 300000
ELSE 0
END
ELSE 0
END
) AS TongPhatNghi,
format (
SUM(
CASE
WHEN ChamCong.GioRa IS NOT NULL AND CAST(ChamCong.GioRa AS TIME) > CAST('17:00:00' AS TIME)
THEN DATEDIFF(minute, CAST('17:00:00' AS TIME), CAST(ChamCong.GioRa AS TIME)) / 60.0 * 100000
ELSE 0
END
),'N0'
) AS TongTangCa,
SUM(
CASE
WHEN ChamCong.GioVao IS NOT NULL AND CAST(ChamCong.GioVao AS TIME) > CAST('08:00:00' AS TIME)
THEN DATEDIFF(minute, CAST('08:00:00' AS TIME), CAST(ChamCong.GioVao AS TIME)) / 60.0 * 200000
ELSE 0
END
) AS TongPhatDiMuon
FROM
nhanvien
JOIN ChamCong ON nhanvien.MaNV = ChamCong.MaNV
JOIN temp ON ChamCong.MaNV = temp.MaNV AND ChamCong.Thang = temp.Thang AND ChamCong.Nam = temp.Nam AND ChamCong.Ngay = temp.Ngay
WHERE
ChamCong.Thang = 1 AND ChamCong.Nam = 2022
GROUP BY
nhanvien.MaNV,
nhanvien.HoTenNV;